<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.1.189">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>ISSS624 - Take-home Exercise 2: Regionalisation of Multivariate Water Point Attributes with Non-spatially Constrained and Spatially Constrained Clustering Methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1.6em;
  vertical-align: middle;
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


<link rel="stylesheet" href="../styles.css">
</head>

<body class="nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="../index.html">
    <span class="navbar-title">ISSS624</span>
    </a>
  </div>
          <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarCollapse" aria-controls="navbarCollapse" aria-expanded="false" aria-label="Toggle navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
  <span class="navbar-toggler-icon"></span>
</button>
          <div class="collapse navbar-collapse" id="navbarCollapse">
            <ul class="navbar-nav navbar-nav-scroll me-auto">
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-hands-on-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">Hands-on Exercise</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-hands-on-exercise">    
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex1/Hands-on_Ex1.html">
 <span class="dropdown-text">Hands-on Exercise 1.1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex1/Hands-on_Ex1_2.html">
 <span class="dropdown-text">Hands-on Exercise 1.2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex2/Hands-on_Ex2.html">
 <span class="dropdown-text">Hands-on Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex3/Hands-on_Ex3.html">
 <span class="dropdown-text">Hands-on Exercise 3</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Hands-on_Ex/Hands-on_Ex4/Hands-on_Ex4.html">
 <span class="dropdown-text">Hands-on Exercise 4</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-in-class-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">In-class Exercise</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-in-class-exercise">    
        <li>
    <a class="dropdown-item" href="../In-class_Ex/In-class_Ex1/In-class_Ex1.html">
 <span class="dropdown-text">In-class Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex/In-class_Ex2.html">
 <span class="dropdown-text">In-class Exercise 2</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../In-class_Ex/In-class_Ex3.html">
 <span class="dropdown-text">In-class Exercise 3</span></a>
  </li>  
    </ul>
  </li>
  <li class="nav-item dropdown ">
    <a class="nav-link dropdown-toggle" href="#" id="nav-menu-take-home-exercise" role="button" data-bs-toggle="dropdown" aria-expanded="false">Take-home Exercise</a>
    <ul class="dropdown-menu" aria-labelledby="nav-menu-take-home-exercise">    
        <li>
    <a class="dropdown-item" href="../Take-home_Ex/Take-home_Ex1.html">
 <span class="dropdown-text">Take-home Exercise 1</span></a>
  </li>  
        <li>
    <a class="dropdown-item" href="../Take-home_Ex/Take-home_Ex2.html">
 <span class="dropdown-text">Take-home Exercise 2</span></a>
  </li>  
    </ul>
  </li>
</ul>
            <ul class="navbar-nav navbar-nav-scroll ms-auto">
  <li class="nav-item">
    <a class="nav-link" href="../index.html">Home</a>
  </li>  
  <li class="nav-item">
    <a class="nav-link" href="../about.html">About</a>
  </li>  
</ul>
              <div id="quarto-search" class="" title="Search"></div>
          </div> <!-- /navcollapse -->
      </div> <!-- /container-fluid -->
    </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#the-task" id="toc-the-task" class="nav-link active" data-scroll-target="#the-task">The Task</a>
  <ul class="collapse">
  <li><a href="#thematic-mapping" id="toc-thematic-mapping" class="nav-link" data-scroll-target="#thematic-mapping">Thematic Mapping</a></li>
  <li><a href="#analytical-mapping" id="toc-analytical-mapping" class="nav-link" data-scroll-target="#analytical-mapping">Analytical Mapping</a></li>
  </ul></li>
  <li><a href="#overview" id="toc-overview" class="nav-link" data-scroll-target="#overview">Overview</a></li>
  <li><a href="#installing-loading-r-packages" id="toc-installing-loading-r-packages" class="nav-link" data-scroll-target="#installing-loading-r-packages">Installing &amp; Loading R Packages</a></li>
  <li><a href="#the-data" id="toc-the-data" class="nav-link" data-scroll-target="#the-data">The Data</a>
  <ul class="collapse">
  <li><a href="#aspatial-data" id="toc-aspatial-data" class="nav-link" data-scroll-target="#aspatial-data">Aspatial data</a></li>
  <li><a href="#geospatial-data" id="toc-geospatial-data" class="nav-link" data-scroll-target="#geospatial-data">Geospatial data</a></li>
  <li><a href="#importing-water-point-data" id="toc-importing-water-point-data" class="nav-link" data-scroll-target="#importing-water-point-data">Importing water point data</a></li>
  <li><a href="#importing-nigeria-lga-level-boundary-data" id="toc-importing-nigeria-lga-level-boundary-data" class="nav-link" data-scroll-target="#importing-nigeria-lga-level-boundary-data">Importing Nigeria LGA level boundary data</a></li>
  <li><a href="#correcting-duplicated-lgas" id="toc-correcting-duplicated-lgas" class="nav-link" data-scroll-target="#correcting-duplicated-lgas">Correcting duplicated LGAs</a></li>
  </ul></li>
  <li><a href="#point-in-polygon-overlay" id="toc-point-in-polygon-overlay" class="nav-link" data-scroll-target="#point-in-polygon-overlay">Point in Polygon Overlay</a></li>
  <li><a href="#data-wrangling" id="toc-data-wrangling" class="nav-link" data-scroll-target="#data-wrangling">Data Wrangling</a>
  <ul class="collapse">
  <li><a href="#recoding-na-values-into-string" id="toc-recoding-na-values-into-string" class="nav-link" data-scroll-target="#recoding-na-values-into-string">Recoding NA values into string</a></li>
  <li><a href="#extracting-useful-data-points" id="toc-extracting-useful-data-points" class="nav-link" data-scroll-target="#extracting-useful-data-points">Extracting useful data points</a></li>
  <li><a href="#performing-point-in-polygon-count" id="toc-performing-point-in-polygon-count" class="nav-link" data-scroll-target="#performing-point-in-polygon-count">Performing Point-in-Polygon Count</a></li>
  <li><a href="#derive-new-variables-using-dplyr-package" id="toc-derive-new-variables-using-dplyr-package" class="nav-link" data-scroll-target="#derive-new-variables-using-dplyr-package">Derive new variables using <strong>dplyr</strong> package</a></li>
  </ul></li>
  <li><a href="#exploratory-data-analysis-eda" id="toc-exploratory-data-analysis-eda" class="nav-link" data-scroll-target="#exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</a>
  <ul class="collapse">
  <li><a href="#eda-using-statistical-graphics" id="toc-eda-using-statistical-graphics" class="nav-link" data-scroll-target="#eda-using-statistical-graphics">EDA using statistical graphics</a></li>
  <li><a href="#eda-using-choropleth-map" id="toc-eda-using-choropleth-map" class="nav-link" data-scroll-target="#eda-using-choropleth-map">EDA using choropleth map</a></li>
  </ul></li>
  <li><a href="#correlation-analysis" id="toc-correlation-analysis" class="nav-link" data-scroll-target="#correlation-analysis">Correlation Analysis</a></li>
  <li><a href="#hierarchy-cluster-analysis" id="toc-hierarchy-cluster-analysis" class="nav-link" data-scroll-target="#hierarchy-cluster-analysis">Hierarchy Cluster Analysis</a>
  <ul class="collapse">
  <li><a href="#extracting-clustering-variables" id="toc-extracting-clustering-variables" class="nav-link" data-scroll-target="#extracting-clustering-variables">Extracting clustering variables</a></li>
  <li><a href="#data-standardisation" id="toc-data-standardisation" class="nav-link" data-scroll-target="#data-standardisation">Data Standardisation</a></li>
  <li><a href="#computing-proximity-matrix" id="toc-computing-proximity-matrix" class="nav-link" data-scroll-target="#computing-proximity-matrix">Computing proximity matrix</a></li>
  <li><a href="#computing-hierarchical-clustering" id="toc-computing-hierarchical-clustering" class="nav-link" data-scroll-target="#computing-hierarchical-clustering">Computing hierarchical clustering</a></li>
  <li><a href="#selecting-the-optimal-clustering-algorithm" id="toc-selecting-the-optimal-clustering-algorithm" class="nav-link" data-scroll-target="#selecting-the-optimal-clustering-algorithm">Selecting the optimal clustering algorithm</a></li>
  <li><a href="#determining-optimal-clusters" id="toc-determining-optimal-clusters" class="nav-link" data-scroll-target="#determining-optimal-clusters">Determining Optimal Clusters</a></li>
  <li><a href="#interpreting-the-dendrograms" id="toc-interpreting-the-dendrograms" class="nav-link" data-scroll-target="#interpreting-the-dendrograms">Interpreting the dendrograms</a></li>
  <li><a href="#visually-driven-hierarchical-clustering-analysis" id="toc-visually-driven-hierarchical-clustering-analysis" class="nav-link" data-scroll-target="#visually-driven-hierarchical-clustering-analysis">Visually-driven hierarchical clustering analysis</a></li>
  <li><a href="#mapping-the-clusters-formed" id="toc-mapping-the-clusters-formed" class="nav-link" data-scroll-target="#mapping-the-clusters-formed">Mapping the clusters formed</a></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Take-home Exercise 2: Regionalisation of Multivariate Water Point Attributes with Non-spatially Constrained and Spatially Constrained Clustering Methods</h1>
</div>



<div class="quarto-title-meta">

    
    
  </div>
  

</header>

<section id="the-task" class="level2">
<h2 class="anchored" data-anchor-id="the-task">The Task</h2>
<p>The specific tasks of this take-home exercise are as follows:</p>
<ul>
<li><p>Using appropriate <strong>sf</strong> method, import the shapefile into R and save it in a simple feature data frame format. Note that there are three Projected Coordinate Systems of Nigeria, they are: EPSG: 26391, 26392, and 26303. We can use any one of them.</p></li>
<li><p>Using appropriate <strong>tidyr</strong> and <strong>dplyr</strong> methods, derive the proportion of functional and non-functional water point at LGA level (i.e.&nbsp;ADM2).</p></li>
<li><p>Combining the geospatial and aspatial data frame into simple feature data frame.</p></li>
<li><p>Delineating water point measures functional regions by using conventional hierarchical clustering.</p></li>
<li><p>Delineating water point measures functional regions by using spatially constrained clustering algorithms.</p></li>
</ul>
<section id="thematic-mapping" class="level3">
<h3 class="anchored" data-anchor-id="thematic-mapping">Thematic Mapping</h3>
<ul>
<li>Plot to show the water points measures derived by using appropriate statistical graphics and choropleth mapping technique.</li>
</ul>
</section>
<section id="analytical-mapping" class="level3">
<h3 class="anchored" data-anchor-id="analytical-mapping">Analytical Mapping</h3>
<ul>
<li>Plot functional regions delineated by using both non-spatially constrained and spatially constrained clustering algorithms.</li>
</ul>
</section>
</section>
<section id="overview" class="level2">
<h2 class="anchored" data-anchor-id="overview">Overview</h2>
<p>The process of creating regions is called <a href="https://www.researchgate.net/publication/28153673_Supervised_Regionalization_Methods_A_Survey/link/0fcfd5094046b13d35000000/download">regionalisation</a>. A regionalisation is a special kind of clustering where the objective is to group observations which are similar in their statistical attributes, but also in their spatial location.</p>
<p>In this take-home exercise, we are required to regionalise Nigeria by using, but not limited to the following measures:</p>
<ul>
<li><p>Total number of functional water points</p></li>
<li><p>Total number of nonfunctional water points</p></li>
<li><p>Percentage of functional water points</p></li>
<li><p>Percentage of non-functional water points</p></li>
<li><p>Percentage of main water point technology (i.e.&nbsp;Hand Pump)</p></li>
<li><p>Percentage of usage capacity (i.e.&nbsp;&lt; 1000, &gt;=1000)</p></li>
<li><p>Percentage of rural water points</p></li>
</ul>
</section>
<section id="installing-loading-r-packages" class="level2">
<h2 class="anchored" data-anchor-id="installing-loading-r-packages">Installing &amp; Loading R Packages</h2>
<p>In the code chunk below, <em>p_load()</em> of <strong>pacman</strong> package is used to install and load the following R packages into R environment.</p>
<div class="cell">

</div>
</section>
<section id="the-data" class="level2">
<h2 class="anchored" data-anchor-id="the-data">The Data</h2>
<section id="aspatial-data" class="level3">
<h3 class="anchored" data-anchor-id="aspatial-data">Aspatial data</h3>
<p>For the purpose of this exercise, data from <a href="https://www.waterpointdata.org/access-data/">WPdx Global Data Repositories</a> will be used. There are two versions of the data. They are: WPdx-Basic and WPdx+. We are required to use WPdx+ data set.</p>
</section>
<section id="geospatial-data" class="level3">
<h3 class="anchored" data-anchor-id="geospatial-data">Geospatial data</h3>
<p>Nigeria Level-2 Administrative Boundary (also known as Local Government Area) polygon features GIS data will be used in this exercise. The data can be downloaded either from The <a href="https://data.humdata.org/">Humanitarian Data Exchange</a> portal or <a href="https://www.geoboundaries.org/">geoBoundaries</a>.</p>
</section>
<section id="importing-water-point-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-water-point-data">Importing water point data</h3>
<p>First, we are going to import the water point data into R environment.</p>
<div class="cell">

</div>
<p>Thing to learn from the code chunk above:</p>
<ul>
<li><p>The original file name is called <code>Water_Point_Data_Exchange_-_PlusWPdx.csv</code>, it has been rename to <code>WPdx.csv</code> for easy encoding.</p></li>
<li><p>Instead of using <em>read.csv()</em> of Base R to import the csv file into R, <em>read_csv()</em> is <strong>readr</strong> package is used. This is because during the initial data exploration, we notice that there is at least one field name with space between the field name (ie. <em>New Georeferenced Column</em>).</p></li>
<li><p>The data file contains water point data of many countries. In this study, we are interested on water point in Nigeria. Hence, <em>filter()</em> of <strong>dplyr</strong> is used to extract out records belonging to Nigeria only.</p></li>
</ul>
<p>Next, <em>write_rds()</em> of <strong>readr</strong> package is used to save the extracted data table (i.e.&nbsp;<code>wp</code>) into an output file in rds data format. The output file is called <code>wpdx_nga.rds</code> and it is saved in rawdata sub-folder, which will not be uploaded to Git.</p>
<div class="cell">

</div>
<div class="cell">

</div>
<section id="convert-wkt-data" class="level4">
<h4 class="anchored" data-anchor-id="convert-wkt-data">Convert wkt data</h4>
<p>After the data are imported into R environment, it is a good practice to review both the data structure and the data table if it is in tibble data frame format in R Studio.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code># A tibble: 95,008 × 70
   row_id `#source`      #lat_…¹ #lon_…² #repo…³ #stat…⁴ #wate…⁵ #wate…⁶ #wate…⁷
    &lt;dbl&gt; &lt;chr&gt;            &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
 1 429068 GRID3             7.98    5.12 08/29/… Unknown &lt;NA&gt;    &lt;NA&gt;    Tapsta…
 2 222071 Federal Minis…    6.96    3.60 08/16/… Yes     Boreho… Well    Mechan…
 3 160612 WaterAid          6.49    7.93 12/04/… Yes     Boreho… Well    Hand P…
 4 160669 WaterAid          6.73    7.65 12/04/… Yes     Boreho… Well    &lt;NA&gt;   
 5 160642 WaterAid          6.78    7.66 12/04/… Yes     Boreho… Well    Hand P…
 6 160628 WaterAid          6.96    7.78 12/04/… Yes     Boreho… Well    Hand P…
 7 160632 WaterAid          7.02    7.84 12/04/… Yes     Boreho… Well    Hand P…
 8 642747 Living Water …    7.33    8.98 10/03/… Yes     Boreho… Well    Mechan…
 9 642456 Living Water …    7.17    9.11 10/03/… Yes     Boreho… Well    Hand P…
10 641347 Living Water …    7.20    9.22 03/28/… Yes     Boreho… Well    Hand P…
# … with 94,998 more rows, 61 more variables: `#water_tech_category` &lt;chr&gt;,
#   `#facility_type` &lt;chr&gt;, `#clean_country_name` &lt;chr&gt;, `#clean_adm1` &lt;chr&gt;,
#   `#clean_adm2` &lt;chr&gt;, `#clean_adm3` &lt;chr&gt;, `#clean_adm4` &lt;chr&gt;,
#   `#install_year` &lt;dbl&gt;, `#installer` &lt;chr&gt;, `#rehab_year` &lt;lgl&gt;,
#   `#rehabilitator` &lt;lgl&gt;, `#management_clean` &lt;chr&gt;, `#status_clean` &lt;chr&gt;,
#   `#pay` &lt;chr&gt;, `#fecal_coliform_presence` &lt;chr&gt;,
#   `#fecal_coliform_value` &lt;dbl&gt;, `#subjective_quality` &lt;chr&gt;, …</code></pre>
</div>
</div>
<p>Notice that the newly imported tibble data frame (i.e.&nbsp;<code>wpdx_nga</code>) contains a field called <code>New Georeferenced Column</code> which represent spatial data in a textual format. In fact, this kind of text file is popularly known as <strong>Well Known Text</strong> in short <strong>wkt</strong>.</p>
<p>Two steps will be used to convert an asptial data file in wkt format into a sf data frame by using <strong>sf</strong>.</p>
<p>First, <em>st_as_sfc()</em> of <strong>sf</strong> package is used to derive a new field called <code>Geometry</code> as shown in the code chunk below.</p>
<div class="cell">

</div>
<p>If we check the <code>wpdx_nga</code> data frame and scroll to the last field now, we will see a new field called <code>Geometry</code> has been added.</p>
<p>Next, <em>st_sf()</em> will be used to convert the tibble data frame into sf data frame.</p>
<div class="cell">

</div>
<p>The code chunk below reveals the complete information of a feature object by using <a href="https://www.rdocumentation.org/packages/utils/versions/3.6.2/topics/head"><em>head()</em></a> of Base R.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Simple feature collection with 5 features and 70 fields
Geometry type: POINT
Dimension:     XY
Bounding box:  xmin: 3.597668 ymin: 6.48694 xmax: 7.92972 ymax: 7.98
Geodetic CRS:  WGS 84
# A tibble: 5 × 71
  row_id #sour…¹ #lat_…² #lon_…³ #repo…⁴ #stat…⁵ #wate…⁶ #wate…⁷ #wate…⁸ #wate…⁹
   &lt;dbl&gt; &lt;chr&gt;     &lt;dbl&gt;   &lt;dbl&gt; &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;   &lt;chr&gt;  
1 429068 GRID3      7.98    5.12 08/29/… Unknown &lt;NA&gt;    &lt;NA&gt;    Tapsta… Tapsta…
2 222071 Federa…    6.96    3.60 08/16/… Yes     Boreho… Well    Mechan… Mechan…
3 160612 WaterA…    6.49    7.93 12/04/… Yes     Boreho… Well    Hand P… Hand P…
4 160669 WaterA…    6.73    7.65 12/04/… Yes     Boreho… Well    &lt;NA&gt;    &lt;NA&gt;   
5 160642 WaterA…    6.78    7.66 12/04/… Yes     Boreho… Well    Hand P… Hand P…
# … with 61 more variables: `#facility_type` &lt;chr&gt;,
#   `#clean_country_name` &lt;chr&gt;, `#clean_adm1` &lt;chr&gt;, `#clean_adm2` &lt;chr&gt;,
#   `#clean_adm3` &lt;chr&gt;, `#clean_adm4` &lt;chr&gt;, `#install_year` &lt;dbl&gt;,
#   `#installer` &lt;chr&gt;, `#rehab_year` &lt;lgl&gt;, `#rehabilitator` &lt;lgl&gt;,
#   `#management_clean` &lt;chr&gt;, `#status_clean` &lt;chr&gt;, `#pay` &lt;chr&gt;,
#   `#fecal_coliform_presence` &lt;chr&gt;, `#fecal_coliform_value` &lt;dbl&gt;,
#   `#subjective_quality` &lt;chr&gt;, `#activity_id` &lt;chr&gt;, `#scheme_id` &lt;chr&gt;, …</code></pre>
</div>
</div>
</section>
</section>
<section id="importing-nigeria-lga-level-boundary-data" class="level3">
<h3 class="anchored" data-anchor-id="importing-nigeria-lga-level-boundary-data">Importing Nigeria LGA level boundary data</h3>
<p>For the purpose of this exercise, shapefile downloaded from <a href="https://www.geoboundaries.org/">geoBoundaries</a> portal will be used.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Reading layer `geoBoundaries-NGA-ADM2' from data source 
  `C:\Jacobche\ISSS624\Take-home_Ex\data' using driver `ESRI Shapefile'
Simple feature collection with 774 features and 5 fields
Geometry type: MULTIPOLYGON
Dimension:     XY
Bounding box:  xmin: 2.668534 ymin: 4.273007 xmax: 14.67882 ymax: 13.89442
Geodetic CRS:  WGS 84</code></pre>
</div>
</div>
</section>
<section id="correcting-duplicated-lgas" class="level3">
<h3 class="anchored" data-anchor-id="correcting-duplicated-lgas">Correcting duplicated LGAs</h3>
<p>The code chunk below (as used by <a href="https://jordan-isss624-geospatial.netlify.app/posts/geo/geospatial_exercise/#data-wrangling">Jordan</a>) uses <em>duplicated()</em> of base R which has identified 12 LGAs (ie <code>shapeName</code>) having duplicates.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code> [1] "Bassa"    "Bassa"    "Ifelodun" "Ifelodun" "Irepodun" "Irepodun"
 [7] "Nasarawa" "Nasarawa" "Obi"      "Obi"      "Surulere" "Surulere"</code></pre>
</div>
</div>
<p>After some research, the corrected index and shapeName should be as follows:</p>
<table class="table">
<thead>
<tr class="header">
<th>Index</th>
<th>shapeName</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>94</td>
<td>Bassa Kogi</td>
</tr>
<tr class="even">
<td>95</td>
<td>Bassa Plateau</td>
</tr>
<tr class="odd">
<td>304</td>
<td>Ifelodun Kwara</td>
</tr>
<tr class="even">
<td>305</td>
<td>Ifelodun Osun</td>
</tr>
<tr class="odd">
<td>355</td>
<td>Irepodun Kwara</td>
</tr>
<tr class="even">
<td>356</td>
<td>Irepodun Osun</td>
</tr>
<tr class="odd">
<td>519</td>
<td>Nasarawa Kano</td>
</tr>
<tr class="even">
<td>520</td>
<td>Nasarawa</td>
</tr>
<tr class="odd">
<td>546</td>
<td>Obi Benue</td>
</tr>
<tr class="even">
<td>547</td>
<td>Obi Nasarawa</td>
</tr>
<tr class="odd">
<td>693</td>
<td>Surulere Lagos</td>
</tr>
<tr class="even">
<td>694</td>
<td>Surulere Oyo</td>
</tr>
</tbody>
</table>
<p>The code chunk below is used to correct the respective <code>shapeName</code> values.</p>
<div class="cell">

</div>
<p>The code chunk below uses <em>length()</em> of base R to validate that there are no more duplicates in LGAs.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>[1] 0</code></pre>
</div>
</div>
</section>
</section>
<section id="point-in-polygon-overlay" class="level2">
<h2 class="anchored" data-anchor-id="point-in-polygon-overlay">Point in Polygon Overlay</h2>
<p>Although <code>wpdx_sf</code> sf data frame consists of a field called <code>#clean_adm2</code> which by right should provide the LGA names of the water points located. However, it is always a good practice to be more causcious when dealing with data accuracy.</p>
<p>In this section, we are going to use a geoprocessing function (or commonly know as GIS analysis) called <strong>point-in-polygon overlay</strong> to transfer the attribute information in <code>nga</code> sf data frame into <code>wpdx_sf</code> data frame. The code chunk below uses <em>st_join()</em> of <strong>sf</strong> package to perform a join and a new field called <code>shapeName</code> is now added to <code>wpdx_sf</code> sf data frame.</p>
<div class="cell">

</div>
</section>
<section id="data-wrangling" class="level2">
<h2 class="anchored" data-anchor-id="data-wrangling">Data Wrangling</h2>
<section id="recoding-na-values-into-string" class="level3">
<h3 class="anchored" data-anchor-id="recoding-na-values-into-string">Recoding NA values into string</h3>
<p>In the code chunk below, <em>replace_na()</em> is used to recode all the <em>NA</em> values in <code>#status_clean</code> and <code>#water_tech_category</code> fields into <em>Unknown</em>.</p>
<div class="cell">

</div>
</section>
<section id="extracting-useful-data-points" class="level3">
<h3 class="anchored" data-anchor-id="extracting-useful-data-points">Extracting useful data points</h3>
<p>In the code chunk below, <em>filter()</em> of <strong>dplyr</strong> is used to select water points of various <code>#status_clean</code>.</p>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">

</div>
<p>In the code chunk below, we will check the proportions in <code>#water-tech-category</code> and then use <em>filter()</em> of <strong>dplyr</strong> to select only the water points of sizable proportions.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-18-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<div class="cell">

</div>
<p>In the code chunk below, <em>filter()</em> of <strong>dplyr</strong> is used to select water points of <code>usage_capacity</code> &gt;=1000 and those &lt;1000.</p>
<div class="cell">

</div>
<p>In the code chunk below, <em>filter()</em> of <strong>dplyr</strong> is used to select water points of <code>is_urban</code> = False and those = True.</p>
<div class="cell">

</div>
</section>
<section id="performing-point-in-polygon-count" class="level3">
<h3 class="anchored" data-anchor-id="performing-point-in-polygon-count">Performing Point-in-Polygon Count</h3>
<p>The code chunk below performs two operations at one go. Firstly, identify water points located inside each LGA by using <a href="https://r-spatial.github.io/sf/reference/geos_binary_pred.html"><em>st_intersects()</em></a>. Next, <a href="https://www.rdocumentation.org/packages/base/versions/3.6.2/topics/length"><em>length()</em></a> of Base R is used to calculate numbers of water points that fall inside each LGA.</p>
<div class="cell">

</div>
<p>The code chunk below reveal the summary statistics of <strong>nga_wp</strong> data frame.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  shapeName                  geometry      total_wp        func_wp      
 Length:774         MULTIPOLYGON :774   Min.   :  0.0   Min.   :  0.00  
 Class :character   epsg:4326    :  0   1st Qu.: 45.0   1st Qu.: 17.00  
 Mode  :character   +proj=long...:  0   Median : 96.0   Median : 45.50  
                                        Mean   :122.7   Mean   : 67.36  
                                        3rd Qu.:168.8   3rd Qu.: 87.75  
                                        Max.   :894.0   Max.   :752.00  
   nonfunc_wp       unknown_wp      handpump_wp     mechanized_wp   
 Min.   :  0.00   Min.   :  0.00   Min.   :  0.00   Min.   :  0.00  
 1st Qu.: 12.25   1st Qu.:  0.00   1st Qu.:  6.00   1st Qu.: 11.00  
 Median : 34.00   Median :  0.00   Median : 47.00   Median : 25.50  
 Mean   : 41.60   Mean   : 13.76   Mean   : 75.89   Mean   : 33.12  
 3rd Qu.: 60.75   3rd Qu.: 17.75   3rd Qu.:111.00   3rd Qu.: 46.00  
 Max.   :278.00   Max.   :219.00   Max.   :764.00   Max.   :245.00  
  highusage_wp     lowusage_wp        rural_wp         urban_wp     
 Min.   :  0.00   Min.   :  0.00   Min.   :  0.00   Min.   :  0.00  
 1st Qu.: 11.00   1st Qu.: 16.00   1st Qu.: 23.00   1st Qu.:  0.00  
 Median : 25.50   Median : 60.00   Median : 64.00   Median :  9.00  
 Mean   : 33.12   Mean   : 89.59   Mean   : 97.45   Mean   : 25.27  
 3rd Qu.: 46.00   3rd Qu.:127.75   3rd Qu.:141.00   3rd Qu.: 33.00  
 Max.   :245.00   Max.   :767.00   Max.   :894.00   Max.   :324.00  </code></pre>
</div>
</div>
</section>
<section id="derive-new-variables-using-dplyr-package" class="level3">
<h3 class="anchored" data-anchor-id="derive-new-variables-using-dplyr-package">Derive new variables using <strong>dplyr</strong> package</h3>
<p>The unit of measurement of the values are number of water points. Using these values directly will be biased towards the underlying total number of water points. In order to overcome this problem, we will derive the percentages of each variable by using the code chunk below.</p>
<div class="cell">

</div>
<p>We notice there are some NA values in the <strong>nga_wp_derived</strong> data frame. As such, <em>is.na()</em> of base R is used to replace NA with 0.</p>
<div class="cell">

</div>
<p>Let us review the summary statistics of the newly derived variables using the code chunk below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  shapeName            func_wp         nonfunc_wp       func_perc     
 Length:774         Min.   :  0.00   Min.   :  0.00   Min.   :0.0000  
 Class :character   1st Qu.: 17.00   1st Qu.: 12.25   1st Qu.:0.3261  
 Mode  :character   Median : 45.50   Median : 34.00   Median :0.4741  
                    Mean   : 67.36   Mean   : 41.60   Mean   :0.4984  
                    3rd Qu.: 87.75   3rd Qu.: 60.75   3rd Qu.:0.6699  
                    Max.   :752.00   Max.   :278.00   Max.   :1.0000  
  nonfunc_perc    handpump_perc    mechanized_perc  highusage_perc  
 Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   Min.   :0.0000  
 1st Qu.:0.2105   1st Qu.:0.1670   1st Qu.:0.1220   1st Qu.:0.1220  
 Median :0.3505   Median :0.5099   Median :0.3127   Median :0.3127  
 Mean   :0.3592   Mean   :0.4873   Mean   :0.3754   Mean   :0.3754  
 3rd Qu.:0.5076   3rd Qu.:0.7778   3rd Qu.:0.5771   3rd Qu.:0.5771  
 Max.   :1.0000   Max.   :1.0000   Max.   :1.0000   Max.   :1.0000  
 lowusage_perc      rural_perc       urban_perc              geometry  
 Min.   :0.0000   Min.   :0.0000   Min.   :0.0000   MULTIPOLYGON :774  
 1st Qu.:0.3968   1st Qu.:0.5727   1st Qu.:0.0000   epsg:4326    :  0  
 Median :0.6703   Median :0.8645   Median :0.1195   +proj=long...:  0  
 Mean   :0.6078   Mean   :0.7271   Mean   :0.2561                      
 3rd Qu.:0.8735   3rd Qu.:1.0000   3rd Qu.:0.3844                      
 Max.   :1.0000   Max.   :1.0000   Max.   :1.0000                      </code></pre>
</div>
</div>
</section>
</section>
<section id="exploratory-data-analysis-eda" class="level2">
<h2 class="anchored" data-anchor-id="exploratory-data-analysis-eda">Exploratory Data Analysis (EDA)</h2>
<section id="eda-using-statistical-graphics" class="level3">
<h3 class="anchored" data-anchor-id="eda-using-statistical-graphics">EDA using statistical graphics</h3>
<p>The code below uses <a href="https://rpkgs.datanovia.com/ggpubr/reference/ggarrange.html"><em>ggarange()</em></a> function of <a href="https://rpkgs.datanovia.com/ggpubr/"><strong>ggpubr</strong></a> package to compute multiple histograms so as to reveal the distribution of the selected variables in the <strong>nga_wp_derived</strong> data frame.</p>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-28-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the above, we can observe that <code>func_perc</code> and <code>nonfunc_perc</code> are more normally distributed compared to other variables.</p>
</section>
<section id="eda-using-choropleth-map" class="level3">
<h3 class="anchored" data-anchor-id="eda-using-choropleth-map">EDA using choropleth map</h3>
<p>To have a quick look at the distribution of functional water points percentage of Nigeria at LGA level, a choropleth map will be prepared.</p>
<p>The code chunk below is used to prepare the choropleth by using the <em>qtm()</em> function of <strong>tmap</strong> package.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-29-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>In order to reveal the distribution shown in the choropleth map above are biased towards the underlying number of functional water points at the LGAs, we will create two choropleth maps, one for the number of fucntional water points(i.e.&nbsp;<code>func.map</code>) and one for the percentage of functional water points (f<code>unc_perc.map</code>) by using the code chunk below.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-30-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>Notice that there are areas with high proportions of functional water points but the actual number of functional water points are low.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-31-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The same observation also holds for non-functional water points aspect where there are high areas with high proportions of non-functional water points but the actual number of non-functional water points are low.</p>
</section>
</section>
<section id="correlation-analysis" class="level2">
<h2 class="anchored" data-anchor-id="correlation-analysis">Correlation Analysis</h2>
<p>Before we perform cluster analysis, it is important for us to ensure that the cluster variables are not highly correlated. The code below uses <a href="https://cran.r-project.org/web/packages/corrplot/corrplot.pdf"><em>corrplot.mixed()</em></a> function of <a href="https://cran.r-project.org/web/packages/corrplot/vignettes/corrplot-intro.html"><strong>corrplot</strong></a> package to visualise and analyse the correlation of the input variables.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-32-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The correlation plot above shows that <code>mechanised_perc</code> and <code>highusage_perc</code> are highly correlated, and similar high correlation is also spotted in <code>handpump_perc</code> and <code>lowusage_perc</code>. This suggests that only one of them in each pair should be used in the cluster analysis instead of both.</p>
</section>
<section id="hierarchy-cluster-analysis" class="level2">
<h2 class="anchored" data-anchor-id="hierarchy-cluster-analysis">Hierarchy Cluster Analysis</h2>
<p>In this section, we will perform hierarchical cluster analysis.</p>
<section id="extracting-clustering-variables" class="level3">
<h3 class="anchored" data-anchor-id="extracting-clustering-variables">Extracting clustering variables</h3>
<p>The code chunk below will be used to extract the clustering variables from <code>nga_wp_derived_new</code>.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>        shapeName func_perc nonfunc_perc handpump_perc mechanized_perc
1       Aba North 0.4117647    0.5294118    0.11764706       0.8235294
2       Aba South 0.4084507    0.4929577    0.09859155       0.8732394
3          Abadam 0.0000000    0.0000000    0.00000000       0.0000000
4           Abaji 0.4035088    0.5964912    0.40350877       0.5964912
5            Abak 0.4791667    0.5208333    0.08333333       0.9166667
6       Abakaliki 0.3519313    0.1802575    0.43776824       0.0944206
7  Abeokuta North 0.4705882    0.4411765    0.14705882       0.7647059
8  Abeokuta South 0.6050420    0.2773109    0.16806723       0.7058824
9             Abi 0.5197368    0.4078947    0.59868421       0.3289474
10    Aboh-Mbaise 0.2727273    0.3939394    0.01515152       0.6515152
   rural_perc urban_perc
1  0.00000000 1.00000000
2  0.05633803 0.94366197
3  0.00000000 0.00000000
4  0.84210526 0.15789474
5  0.83333333 0.16666667
6  0.87553648 0.12446352
7  0.20588235 0.79411765
8  0.00000000 1.00000000
9  0.95394737 0.04605263
10 0.72727273 0.27272727</code></pre>
</div>
</div>
<p>Notice that the final clustering variables list does not include variable <code>highusage_perc</code> and <code>lowusage_perc</code>because they are highly correlated with variable <code>mechanised_perc</code> and <code>handpump_perc</code> respectively.</p>
<p>Next, we need to change the rows by LGA name instead of row number by using the code chunk below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                    shapeName func_perc nonfunc_perc handpump_perc
Aba North           Aba North 0.4117647    0.5294118    0.11764706
Aba South           Aba South 0.4084507    0.4929577    0.09859155
Abadam                 Abadam 0.0000000    0.0000000    0.00000000
Abaji                   Abaji 0.4035088    0.5964912    0.40350877
Abak                     Abak 0.4791667    0.5208333    0.08333333
Abakaliki           Abakaliki 0.3519313    0.1802575    0.43776824
Abeokuta North Abeokuta North 0.4705882    0.4411765    0.14705882
Abeokuta South Abeokuta South 0.6050420    0.2773109    0.16806723
Abi                       Abi 0.5197368    0.4078947    0.59868421
Aboh-Mbaise       Aboh-Mbaise 0.2727273    0.3939394    0.01515152
               mechanized_perc rural_perc urban_perc
Aba North            0.8235294 0.00000000 1.00000000
Aba South            0.8732394 0.05633803 0.94366197
Abadam               0.0000000 0.00000000 0.00000000
Abaji                0.5964912 0.84210526 0.15789474
Abak                 0.9166667 0.83333333 0.16666667
Abakaliki            0.0944206 0.87553648 0.12446352
Abeokuta North       0.7647059 0.20588235 0.79411765
Abeokuta South       0.7058824 0.00000000 1.00000000
Abi                  0.3289474 0.95394737 0.04605263
Aboh-Mbaise          0.6515152 0.72727273 0.27272727</code></pre>
</div>
</div>
<p>Notice that the row number has been replaced into the LGA name.</p>
<p>Now, we will delete the <code>shapeName</code> field by using the code chunk below.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>               func_perc nonfunc_perc handpump_perc mechanized_perc rural_perc
Aba North      0.4117647    0.5294118    0.11764706       0.8235294 0.00000000
Aba South      0.4084507    0.4929577    0.09859155       0.8732394 0.05633803
Abadam         0.0000000    0.0000000    0.00000000       0.0000000 0.00000000
Abaji          0.4035088    0.5964912    0.40350877       0.5964912 0.84210526
Abak           0.4791667    0.5208333    0.08333333       0.9166667 0.83333333
Abakaliki      0.3519313    0.1802575    0.43776824       0.0944206 0.87553648
Abeokuta North 0.4705882    0.4411765    0.14705882       0.7647059 0.20588235
Abeokuta South 0.6050420    0.2773109    0.16806723       0.7058824 0.00000000
Abi            0.5197368    0.4078947    0.59868421       0.3289474 0.95394737
Aboh-Mbaise    0.2727273    0.3939394    0.01515152       0.6515152 0.72727273
               urban_perc
Aba North      1.00000000
Aba South      0.94366197
Abadam         0.00000000
Abaji          0.15789474
Abak           0.16666667
Abakaliki      0.12446352
Abeokuta North 0.79411765
Abeokuta South 1.00000000
Abi            0.04605263
Aboh-Mbaise    0.27272727</code></pre>
</div>
</div>
</section>
<section id="data-standardisation" class="level3">
<h3 class="anchored" data-anchor-id="data-standardisation">Data Standardisation</h3>
<p>In order to avoid the cluster analysis result being biased towards clustering variables with large values, it is useful to standardise the input variables before performing cluster analysis.</p>
<p>The code chunk below will be used to standardisation the clustering variables by using Z-score method.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>                vars   n mean sd median trimmed  mad   min  max range  skew
func_perc          1 774    0  1  -0.10   -0.02 1.04 -2.06 2.07  4.13  0.14
nonfunc_perc       2 774    0  1  -0.04   -0.03 1.05 -1.71 3.05  4.76  0.24
handpump_perc      3 774    0  1   0.07    0.00 1.37 -1.49 1.57  3.06 -0.09
mechanized_perc    4 774    0  1  -0.21   -0.09 1.05 -1.28 2.14  3.42  0.61
rural_perc         5 774    0  1   0.42    0.17 0.62 -2.23 0.84  3.06 -1.12
urban_perc         6 774    0  1  -0.44   -0.18 0.56 -0.82 2.37  3.19  1.19
                kurtosis   se
func_perc          -0.62 0.04
nonfunc_perc       -0.45 0.04
handpump_perc      -1.33 0.04
mechanized_perc    -0.78 0.04
rural_perc         -0.09 0.04
urban_perc          0.16 0.04</code></pre>
</div>
</div>
<p>Notice the mean and standard deviation of the Z-score standardised clustering variables are 0 and 1 respectively. We need to bear in mind that Z-score standardisation method should only be used if we would assume all variables come from some normal distribution.</p>
</section>
<section id="computing-proximity-matrix" class="level3">
<h3 class="anchored" data-anchor-id="computing-proximity-matrix">Computing proximity matrix</h3>
<p>The code chunk below is used to compute the proximity matrix using <em>euclidean</em> method.</p>
<div class="cell">

</div>
<p>The code chunk below can then be used to list the content of <code>proxmat</code> for visual inspection.</p>
<div class="cell">

</div>
<p><img src="images/paste-305FA60D.png" class="img-fluid"></p>
</section>
<section id="computing-hierarchical-clustering" class="level3">
<h3 class="anchored" data-anchor-id="computing-hierarchical-clustering">Computing hierarchical clustering</h3>
<p>The code chunk below uses <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/hclust.html"><em>hclust()</em></a> of R stats to performs hierarchical cluster analysis via the <em>ward.D</em> method. The hierarchical clustering output is stored in an object of class <strong>hclust</strong> which describes the tree produced by the clustering process.</p>
<div class="cell">

</div>
<p>We can then plot the tree by using <a href="https://www.rdocumentation.org/packages/ggdendro/versions/0.1.23/topics/ggdendrogram"><em>ggdendrogram()</em></a> of <strong>ggdendro</strong> package as shown in the code chunk below. <strong>Plotly</strong> has also been used here to add interactivity to the dendrogram so that we are able to zoom in and out easily.</p>
<div class="cell">

</div>
</section>
<section id="selecting-the-optimal-clustering-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="selecting-the-optimal-clustering-algorithm">Selecting the optimal clustering algorithm</h3>
<p>The code chunk below will be used to compute the agglomerative coefficients of all hierarchical clustering algorithms.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>  average    single  complete      ward 
0.9205714 0.8651966 0.9547781 0.9930765 </code></pre>
</div>
</div>
<p>With reference to the output above, we can see that Ward’s method provides the strongest clustering structure among the four methods assessed. Hence, in the subsequent analysis, only Ward’s method will be used.</p>
</section>
<section id="determining-optimal-clusters" class="level3">
<h3 class="anchored" data-anchor-id="determining-optimal-clusters">Determining Optimal Clusters</h3>
<p>We will use the Gap Statistic Method to determine the optimal clusters to retain. To compute the gap statistic, <a href="https://www.rdocumentation.org/packages/cluster/versions/2.1.0/topics/clusGap"><em>clusGap()</em></a> of <a href="https://cran.r-project.org/web/packages/cluster/"><strong>cluster</strong></a> package will be used.</p>
<div class="cell">
<div class="cell-output cell-output-stdout">
<pre><code>Clustering Gap statistic ["clusGap"] from call:
clusGap(x = nga_wp_var, FUNcluster = hcut, K.max = 10, B = 50, nstart = 25)
B=50 simulated reference sets, k = 1..10; spaceH0="scaledPCA"
 --&gt; Number of clusters (method 'firstmax'): 10
          logW   E.logW       gap      SE.sim
 [1,] 5.173680 5.694269 0.5205892 0.008957162
 [2,] 4.945917 5.565201 0.6192844 0.012576939
 [3,] 4.786584 5.483159 0.6965752 0.009618580
 [4,] 4.685945 5.415759 0.7298148 0.013337222
 [5,] 4.629941 5.371421 0.7414807 0.011868180
 [6,] 4.578270 5.333581 0.7553111 0.009754079
 [7,] 4.525729 5.299502 0.7737736 0.009165408
 [8,] 4.492775 5.270735 0.7779597 0.008911302
 [9,] 4.455358 5.245195 0.7898374 0.008767538
[10,] 4.429645 5.222057 0.7924118 0.008601505</code></pre>
</div>
</div>
<p>Next, we can visualise the plot by using <a href="https://rpkgs.datanovia.com/factoextra/reference/fviz_nbclust.html"><em>fviz_gap_stat()</em></a> of <a href="https://rpkgs.datanovia.com/factoextra/"><strong>factoextra</strong></a> package.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-43-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>From the output above, the optimal number of clusters is 4.</p>
</section>
<section id="interpreting-the-dendrograms" class="level3">
<h3 class="anchored" data-anchor-id="interpreting-the-dendrograms">Interpreting the dendrograms</h3>
<p>The code below uses <a href="https://stat.ethz.ch/R-manual/R-devel/library/stats/html/rect.hclust.html"><em>rect.hclust()</em></a> of R stats to add border colors for the rectangles.</p>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-44-1.png" class="img-fluid" width="672"></p>
</div>
</div>
</section>
<section id="visually-driven-hierarchical-clustering-analysis" class="level3">
<h3 class="anchored" data-anchor-id="visually-driven-hierarchical-clustering-analysis">Visually-driven hierarchical clustering analysis</h3>
<p>We will perform visually-driven hierarchical clustering analysis by using <a href="https://cran.r-project.org/web/packages/heatmaply/"><strong>heatmaply</strong></a> package. In the code chunk below, the <a href="https://talgalili.github.io/heatmaply/reference/heatmaply.html"><em>heatmaply()</em></a> of <a href="https://talgalili.github.io/heatmaply/"><strong>heatmaply</strong></a> package is used to build an interactive cluster heatmap.</p>
<div class="cell">

</div>
<div class="cell">

</div>
</section>
<section id="mapping-the-clusters-formed" class="level3">
<h3 class="anchored" data-anchor-id="mapping-the-clusters-formed">Mapping the clusters formed</h3>
<p>In order to visualise the clusters, the code chunk below uses <em>qtm()</em> of <strong>tmap</strong> package is used to plot the choropleth map showing the cluster formed.</p>
<div class="cell">

</div>
<div class="cell">

</div>
<div class="cell">
<div class="cell-output-display">
<p><img src="Take-home_Ex2_files/figure-html/unnamed-chunk-49-1.png" class="img-fluid" width="672"></p>
</div>
</div>
<p>The choropleth map above reveals the clusters are very fragmented. The is one of the major limitation when non-spatial clustering algorithm such as hierarchical cluster analysis method is used.</p>


</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    target: function(trigger) {
      return trigger.previousElementSibling;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    setTimeout(function() {
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const cites = ref.parentNode.getAttribute('data-cites').split(' ');
    tippyHover(ref, function() {
      var popup = window.document.createElement('div');
      cites.forEach(function(cite) {
        var citeDiv = window.document.createElement('div');
        citeDiv.classList.add('hanging-indent');
        citeDiv.classList.add('csl-entry');
        var biblioDiv = window.document.getElementById('ref-' + cite);
        if (biblioDiv) {
          citeDiv.innerHTML = biblioDiv.innerHTML;
        }
        popup.appendChild(citeDiv);
      });
      return popup.innerHTML;
    });
  }
});
</script>
</div> <!-- /content -->



</body></html>